{"version":3,"sources":["bundler/index.ts","components/CodeEditor.tsx","components/Preview.tsx","bundler/plugins/fetch-plugin.ts","bundler/plugins/unpkg-path-plugin.ts","components/Resizable.tsx","components/CodeCell.tsx","index.tsx"],"names":["service","CodeEditor","initialValue","onChange","editorRef","useRef","className","onClick","unformatted","current","getModel","getValue","formatted","prettier","format","parser","plugins","useTabs","semi","replace","setValue","editorDidMount","monacoEditor","onDidChangeModelContent","updateOptions","tabSize","Highlighter","window","monaco","codeShift","highLightOnDidChangeModelContent","undefined","value","height","language","theme","options","wordWrap","minimap","enabled","showUnused","folding","lineNumbersMinChars","fontSize","scrollBeyondLastLine","automaticLayout","html","Preview","code","bundlingStatus","iframe","useEffect","srcdoc","setTimeout","contentWindow","postMessage","title","ref","sandbox","srcDoc","fileCache","localforage","createInstance","name","fetchPlugin","inputCode","setup","build","onLoad","filter","loader","contents","args","getItem","path","cachedResult","axios","get","data","request","escaped","result","resolveDir","URL","responseURL","pathname","setItem","bundler","rawCode","esbuild","worker","wasmURL","entryPoints","bundle","write","onResolve","namespace","href","define","global","outputFiles","text","err","Error","message","Resizable","resizableProps","direction","children","useState","innerHeight","setInnerHeight","innerWidth","setInnerWidth","width","setWidth","timer","listener","clearTimeout","addEventListener","removeEventListener","minConstraints","Infinity","maxConstraints","resizeHandles","onResizeStop","event","size","CodeCell","setCode","input","setInput","setErr","output","style","display","el","document","getElementById","App","ReactDOM","createRoot","render"],"mappings":"8NAIIA,E,+JC2EWC,EAlE+B,SAAH,GAAoC,IAA9BC,EAAY,EAAZA,aAAcC,EAAQ,EAARA,SACvDC,EAAYC,mBAyClB,OACE,sBAAKC,UAAU,iBAAgB,UAC7B,wBAAQA,UAAU,wCAAwCC,QAlBxC,WAEpB,IAAMC,EAAcJ,EAAUK,QAAQC,WAAWC,WAG3CC,EAAYC,IAASC,OAAON,EAAa,CAC7CO,OAAQ,QACRC,QAAS,CAACD,KACVE,SAAS,EACTC,MAAM,IACLC,QAAQ,MAAO,IAGlBf,EAAUK,QAAQW,SAASR,EAC7B,EAIqF,oBACjF,cAAC,IAAY,CACXS,eA3CmC,SAACV,EAAUW,GAAkB,IAAD,EACnElB,EAAUK,QAAUa,EACpBA,EAAaC,yBAAwB,WACnCpB,EAASQ,IACX,IAEuB,QAAvB,EAAAW,EAAaZ,kBAAU,OAAvB,EAAyBc,cAAc,CAAEC,QAAS,IAE9B,IAAIC,IAEtBC,OAAOC,OACPC,IACAP,GAGUQ,kCACV,WAAO,IACP,WAAO,QACPC,GACA,WAAO,GAEX,EAuBMC,MAAO9B,EACP+B,OAAO,OACPC,SAAS,aACTC,MAAM,OACNC,QAAS,CACPC,SAAU,KACVC,QAAS,CAAEC,SAAS,GACpBC,YAAY,EACZC,SAAS,EACTC,oBAAqB,EACrBC,SAAU,GACVC,sBAAsB,EACtBC,iBAAiB,OAK3B,ECpEMC,G,OAAI,gwBA8DKC,EA5ByB,SAAH,GAAkC,IAA5BC,EAAI,EAAJA,KAAMC,EAAc,EAAdA,eACzCC,EAAS7C,mBASf,OAPA8C,qBAAU,WACRD,EAAOzC,QAAQ2C,OAASN,EACxBO,YAAW,WACTH,EAAOzC,QAAQ6C,cAAcC,YAAYP,EAAM,IACjD,GAAG,GACL,GAAG,CAACA,IAGF,sBAAK1C,UAAU,kBAAiB,UAC9B,wBACEkD,MAAM,UACNC,IAAKP,EACLQ,QAAQ,gBACRC,OAAQb,IAETG,GACC,sBAAK3C,UAAU,0BAAyB,UACtC,oBAAIA,UAAU,sBAAqB,+BAClC2C,OAKX,E,0BCjEMW,E,OAAYC,EAAYC,eAAe,CAC3CC,KAAM,cAGKC,EAAc,SAACC,GAC1B,MAAO,CACLF,KAAM,eACNG,MAAK,SAACC,GACJA,EAAMC,OAAO,CAAEC,OAAQ,kBAAmB,WACxC,MAAO,CACLC,OAAQ,MACRC,SAAUN,EAEd,IAEAE,EAAMC,OAAO,CAAEC,OAAQ,MAAM,iDAAE,WAAOG,GAAS,iGAClBZ,EAAUa,QACnCD,EAAKE,MACL,KAAD,EAFiB,KAAZC,EAAY,QAGD,CAAD,wCACPA,GAAY,2CAEtB,mDAP4B,IAS7BR,EAAMC,OAAO,CAAEC,OAAQ,SAAS,iDAAE,WAAOG,GAAS,2GAChBI,IAAMC,IAAIL,EAAKE,MAAM,KAAD,EAgBnD,OAhBmD,SAA5CI,EAAI,EAAJA,KAAMC,EAAO,EAAPA,QAERC,EAAUF,EACb3D,QAAQ,MAAO,IACfA,QAAQ,KAAM,OACdA,QAAQ,KAAM,OACXoD,EAAQ,oGAESS,EAAO,6DAIxBC,EAA+B,CACnCX,OAAQ,MACRC,WACAW,WAAY,IAAIC,IAAI,KAAMJ,EAAQK,aAAaC,UAC/C,EAAD,QAEKzB,EAAU0B,QAAQd,EAAKE,KAAMO,GAAQ,KAAD,4BACnCA,GAAM,4CACd,mDArB+B,IAuBhCd,EAAMC,OAAO,CAAEC,OAAQ,MAAM,iDAAE,WAAOG,GAAS,uGACbI,IAAMC,IAAIL,EAAKE,MAAM,KAAD,EAMnD,OANmD,SAA5CI,EAAI,EAAJA,KAAMC,EAAO,EAAPA,QAERE,EAA+B,CACnCX,OAAQ,MACRC,SAAUO,EACVI,WAAY,IAAIC,IAAI,KAAMJ,EAAQK,aAAaC,UAC/C,EAAD,OAEKzB,EAAU0B,QAAQd,EAAKE,KAAMO,GAAQ,KAAD,2BACnCA,GAAM,2CACd,mDAX4B,GAY/B,EAEJ,EH3DMM,EAAO,iDAAG,WAAOC,GAAe,oFAC/BxF,EAAQ,CAAD,+BACMyF,eAAqB,CACnCC,QAAQ,EACRC,QAAS,uDACR,KAAD,EAHF3F,EAAO,uCAOcA,EAAQmE,MAAM,CACjCyB,YAAa,CAAC,YACdC,QAAQ,EACRC,OAAO,EACP9E,QAAS,CIhBN,CACL+C,KAAM,oBACNG,MAAK,SAACC,GAEJA,EAAM4B,UAAU,CAAE1B,OAAQ,kBAAmB,WAC3C,MAAO,CAAEK,KAAM,WAAYsB,UAAW,IACxC,IAGA7B,EAAM4B,UAAU,CAAE1B,OAAQ,WAAY,SAACG,GACrC,MAAO,CACLwB,UAAW,IACXtB,KAAM,IAAIS,IAAIX,EAAKE,KAAK,oBAAD,OAAsBF,EAAKU,WAAU,MAAKe,KAErE,IAGA9B,EAAM4B,UAAU,CAAE1B,OAAQ,MAAM,iDAAE,WAAOG,GAAS,oGACzC,CACLwB,UAAW,IACXtB,KAAK,qBAAD,OAAuBF,EAAKE,QACjC,2CACF,mDAL+B,GAMlC,GJP+BV,EAAYwB,IACzCU,OAAQ,CACN,uBAAwB,eACxBC,OAAQ,YAET,KAAD,EATU,OAANlB,EAAM,yBAUL,CACLjC,KAAMiC,EAAOmB,YAAY,GAAGC,KAC5BC,IAAK,KACN,uCAEG,gBAAeC,OAAK,0CACf,CACLvD,KAAM,GACNsD,IAAK,KAAIE,UACV,6EAON,gBAnCY,sCAqCEjB,I,0BK4BAkB,EA9D6B,SAAH,GAAiC,IACpEC,EADyCC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAGxD,EAAsCC,mBAASlF,OAAOmF,aAAY,mBAA3DA,EAAW,KAAEC,EAAc,KAClC,EAAoCF,mBAASlF,OAAOqF,YAAW,mBAAxDA,EAAU,KAAEC,EAAa,KAChC,EAA0BJ,mBAA6B,IAApBlF,OAAOqF,YAAkB,mBAArDE,EAAK,KAAEC,EAAQ,KAgDtB,OA9CAhE,qBAAU,WACR,IAAIiE,EACEC,EAAW,WACZD,GACDE,aAAaF,GAEfA,EAAQ/D,YAAW,WACjB0D,EAAepF,OAAOmF,aACtBG,EAActF,OAAOqF,YACE,IAApBrF,OAAOqF,WAAoBE,GAC5BC,EAA6B,IAApBxF,OAAOqF,WAEpB,GAAG,IAEL,EAIA,OAFArF,OAAO4F,iBAAiB,SAAUF,GAE3B,WACL1F,OAAO6F,oBAAoB,SAAUH,EACvC,CACF,GAAG,CAACH,IAGFR,EADgB,eAAdC,EACe,CACfrG,UAAW,oBACXmH,eAAgB,CAAc,GAAbT,EAAkBU,KACnCC,eAAgB,CAAc,IAAbX,EAAmBU,KACpCzF,OAAQyF,IACRR,QACAU,cAAe,CAAC,KAChBC,aAAc,SAACC,EAAOhD,GACpBqC,EAASrC,EAAKiD,KAAKb,MACrB,GAIe,CACfO,eAAgB,CAACC,IAAU,IAC3BC,eAAgB,CAACD,IAAwB,GAAdZ,GAC3B7E,OAAQ,IACRiF,MAAOQ,IACPE,cAAe,CAAC,MAKlB,cAAC,eAAY,2BACPlB,GAAc,aAEjBE,IAGP,EC/BeoB,EAhCE,WACf,MAAwBnB,mBAAS,IAAG,mBAA7B7D,EAAI,KAAEiF,EAAO,KACpB,EAA0BpB,mBAAS,IAAG,mBAA/BqB,EAAK,KAAEC,EAAQ,KACtB,EAAsBtB,mBAAS,IAAG,mBAA3BP,EAAG,KAAE8B,EAAM,KAclB,OAZAjF,qBAAU,WACR,IAAMiE,EAAQ/D,WAAU,gCAAC,8GACFkC,EAAQ2C,GAAO,KAAD,EAA7BG,EAAM,OACZJ,EAAQI,EAAOrF,MACfoF,EAAOC,EAAO/B,KAAK,2CAClB,KAEH,OAAO,WACLgB,aAAaF,EACf,CACF,GAAG,CAACc,IAGF,cAAC,EAAS,CAACvB,UAAU,WAAU,SAC7B,sBAAK2B,MAAO,CAAErG,OAAQ,OAAQsG,QAAS,QAAS,UAC9C,cAAC,EAAS,CAAC5B,UAAU,aAAY,SAC/B,cAAC,EAAU,CACTzG,aAAa,eACbC,SAAU,SAAC6B,GAAK,OAAKmG,EAASnG,EAAM,MAGxC,cAAC,EAAO,CAACgB,KAAMA,EAAMC,eAAgBqD,QAI7C,EChCMkC,EAAKC,SAASC,eAAe,QAG7BC,EAAM,WAEV,OACE,8BACE,cAAC,EAAQ,KAGf,EATaC,IAASC,WAAWL,GAW5BM,OAAO,cAAC,EAAG,I","file":"static/js/main.6f28cc07.chunk.js","sourcesContent":["import * as esbuild from \"esbuild-wasm\";\nimport { unpkgPathPlugin } from \"./plugins/unpkg-path-plugin\";\nimport { fetchPlugin } from \"./plugins/fetch-plugin\";\n\nlet service: esbuild.Service;\n\nconst bundler = async (rawCode: string) => {\n  if (!service) {\n    service = await esbuild.startService({\n      worker: true,\n      wasmURL: \"https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm\",\n    });\n  }\n\n  try {\n    const result = await service.build({\n      entryPoints: [\"index.js\"],\n      bundle: true,\n      write: false,\n      plugins: [unpkgPathPlugin(), fetchPlugin(rawCode)],\n      define: {\n        \"process.env.NODE_ENV\": \"'production'\",\n        global: \"window\",\n      },\n    });\n    return {\n      code: result.outputFiles[0].text,\n      err: \"\"\n    }\n  } catch (err) {\n    if (err instanceof Error) {\n      return {\n        code: \"\",\n        err: err.message,\n      };\n    } else {\n      throw err;\n    }\n  }\n\n\n};\n\nexport default bundler;","import \"./CodeEditor.css\";\nimport \"./syntax.css\";\nimport { useRef } from \"react\";\nimport MonacoEditor, { EditorDidMount } from \"@monaco-editor/react\";\nimport prettier from \"prettier\";\nimport parser from \"prettier/parser-babel\";\nimport codeShift from \"jscodeshift\";\nimport Highlighter from \"monaco-jsx-highlighter\";\ninterface CodeEditorProps {\n  initialValue: string;\n  onChange: (value: string) => void;\n}\n\nconst CodeEditor: React.FC<CodeEditorProps> = ({ initialValue, onChange }) => {\n  const editorRef = useRef<any>();\n\n  const onEditorDidMount: EditorDidMount = (getValue, monacoEditor) => {\n    editorRef.current = monacoEditor;\n    monacoEditor.onDidChangeModelContent(() => {\n      onChange(getValue());\n    });\n\n    monacoEditor.getModel()?.updateOptions({ tabSize: 2 });\n\n    const highlighter = new Highlighter(\n      // @ts-ignore\n      window.monaco,\n      codeShift,\n      monacoEditor\n    );\n\n    highlighter.highLightOnDidChangeModelContent(\n      () => {},\n      () => {},\n      undefined,\n      () => {}\n    );\n  };\n\n  const onFormatClick = () => {    \n    //Get current value from editor\n    const unformatted = editorRef.current.getModel().getValue();\n\n    //Format that value\n    const formatted = prettier.format(unformatted, {\n      parser: \"babel\",\n      plugins: [parser],\n      useTabs: false,\n      semi: true,\n    }).replace(/\\n$/, \"\");\n\n    //Set the formatted value into the editor\n    editorRef.current.setValue(formatted)\n  }\n\n  return (\n    <div className=\"editor-wrapper\">\n      <button className=\"button button-format is-info is-small\" onClick={onFormatClick}>Format</button>\n      <MonacoEditor\n        editorDidMount={onEditorDidMount}\n        value={initialValue}\n        height=\"100%\"\n        language=\"javascript\"\n        theme=\"dark\"\n        options={{\n          wordWrap: \"on\",\n          minimap: { enabled: false },\n          showUnused: false,\n          folding: false,\n          lineNumbersMinChars: 3,\n          fontSize: 16,\n          scrollBeyondLastLine: false,\n          automaticLayout: true,\n        }}\n      />\n    </div>\n  );\n};\n\nexport default CodeEditor;\n","import \"./Preview.css\";\n\nimport { useEffect, useRef } from \"react\";\n\ninterface PreviewProps {\n  code: string;\n  bundlingStatus: string;\n}\n\nconst html = `\n<html>\n  <head>\n    <style>\n      html { background-color: #fff }\n      #root { min-height: 100vh }\n    </style>\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script>\n      const handleError = (err) => {\n        const root = document.querySelector(\"#root\");\n        root.innerHTML = \"<div style='color: red;'><h4>Runtime Error</h4>\" + err + \"</div>\"\n        console.error(err);\n      };\n\n      window.addEventListener('error', (event) => {\n        event.preventDefault();\n        handleError(event.error)\n      })\n\n      window.addEventListener('message', (event) => {\n        try{\n          eval(event.data);\n        } catch(err) {\n          handleError(err)\n        };\n      }, false);\n    </script>\n  </body>\n</html>\n`;\n\nconst Preview: React.FC<PreviewProps> = ({ code, bundlingStatus }) => {\n  const iframe = useRef<any>();\n\n  useEffect(() => {\n    iframe.current.srcdoc = html;\n    setTimeout(() => {\n      iframe.current.contentWindow.postMessage(code, \"*\");\n    }, 50);\n  }, [code]);\n\n  return (\n    <div className=\"preview-wrapper\">\n      <iframe\n        title=\"preview\"\n        ref={iframe}\n        sandbox=\"allow-scripts\"\n        srcDoc={html}\n      />\n      {bundlingStatus && (\n        <div className=\"preview-error-container\">\n          <h4 className=\"preview-error-title\">Compilation error</h4>\n          {bundlingStatus}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Preview;\n","import * as esbuild from \"esbuild-wasm\";\nimport axios from \"axios\";\nimport localforage from \"localforage\";\n\nconst fileCache = localforage.createInstance({\n  name: \"fileCache\",\n});\n\nexport const fetchPlugin = (inputCode: string) => {\n  return {\n    name: \"fetch-plugin\",\n    setup(build: esbuild.PluginBuild) {\n      build.onLoad({ filter: /(^index\\.js$)/ }, () => {\n        return {\n          loader: \"jsx\",\n          contents: inputCode,\n        };\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        const cachedResult = await fileCache.getItem<esbuild.OnLoadResult>(\n          args.path\n        );\n        if (cachedResult) {\n          return cachedResult;\n        }\n      });\n\n      build.onLoad({ filter: /.css$/ }, async (args: any) => {\n        const { data, request } = await axios.get(args.path);\n\n        const escaped = data\n          .replace(/\\n/g, \"\")\n          .replace(/\"/g, '\\\\\"')\n          .replace(/'/g, \"\\\\'\");\n        const contents = `\n          const style = document.createElement(\"style\");\n          style.innerText = '${escaped}';\n          document.head.appendChild(style);\n        `;\n\n        const result: esbuild.OnLoadResult = {\n          loader: \"jsx\",\n          contents,\n          resolveDir: new URL(\"./\", request.responseURL).pathname,\n        };\n\n        await fileCache.setItem(args.path, result);\n        return result;\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        const { data, request } = await axios.get(args.path);\n\n        const result: esbuild.OnLoadResult = {\n          loader: \"jsx\",\n          contents: data,\n          resolveDir: new URL(\"./\", request.responseURL).pathname,\n        };\n\n        await fileCache.setItem(args.path, result);\n        return result;\n      });\n    },\n  };\n};\n","import * as esbuild from \"esbuild-wasm\";\n\nexport const unpkgPathPlugin = () => {\n  return {\n    name: \"unpkg-path-plugin\",\n    setup(build: esbuild.PluginBuild) {\n      // Handle root entry file of \"index.js\"\n      build.onResolve({ filter: /(^index\\.js$)/ }, () => {\n        return { path: \"index.js\", namespace: \"a\" };\n      });\n      \n      // Handle relative paths in a module\n      build.onResolve({ filter: /^\\.+\\// }, (args: any) => {\n        return {\n          namespace: \"a\",\n          path: new URL(args.path, `https://unpkg.com${args.resolveDir}/`).href,\n        };\n      });\n\n      // Handle main file of a module\n      build.onResolve({ filter: /.*/ }, async (args: any) => {\n        return {\n          namespace: \"a\",\n          path: `https://unpkg.com/${args.path}`,\n        };\n      });\n    },\n  };\n};\n","import \"./Resizable.css\";\nimport { useEffect, useState } from \"react\";\nimport { ResizableBox, ResizableBoxProps } from \"react-resizable\";\n\ninterface ResizableProps {\n  direction: \"horizontal\" | \"vertical\";\n  children: React.ReactNode;\n}\n\nconst Resizable: React.FC<ResizableProps> = ({ direction, children }) => {\n  let resizableProps: ResizableBoxProps;\n\n  const [innerHeight, setInnerHeight] = useState(window.innerHeight);\n  const [innerWidth, setInnerWidth] = useState(window.innerWidth);\n  const [width, setWidth] = useState(window.innerWidth * 0.75);\n\n  useEffect(() => {\n    let timer: any;\n    const listener = () => {\n      if(timer){\n        clearTimeout(timer);\n      }\n      timer = setTimeout(() => {\n        setInnerHeight(window.innerHeight);\n        setInnerWidth(window.innerWidth);\n        if(window.innerWidth * 0.75 < width){\n          setWidth(window.innerWidth * 0.75);\n        }\n      }, 100);\n\n    };\n\n    window.addEventListener(\"resize\", listener);\n\n    return () => {\n      window.removeEventListener(\"resize\", listener);\n    }\n  }, [width])\n\n  if (direction === \"horizontal\") {\n    resizableProps = {\n      className: \"resize-horizontal\",\n      minConstraints: [innerWidth * 0.2, Infinity],\n      maxConstraints: [innerWidth * 0.75, Infinity],\n      height: Infinity,\n      width,\n      resizeHandles: [\"e\"],\n      onResizeStop: (event, data) => {\n        setWidth(data.size.width);\n      }\n    }\n  } \n  else{ \n    resizableProps = {\n      minConstraints: [Infinity, 50],\n      maxConstraints: [Infinity, innerHeight * 0.9],\n      height: 300,\n      width: Infinity,\n      resizeHandles: [\"s\"],\n    }\n  }\n\n  return (\n    <ResizableBox\n      {...resizableProps}\n    >\n      {children}\n    </ResizableBox>\n  );\n};\n\nexport default Resizable;\n","import { useState, useEffect } from \"react\";\nimport CodeEditor from \"./CodeEditor\";\nimport Preview from \"./Preview\";\nimport bundler from \"../bundler\";\nimport Resizable from \"./Resizable\";\n\nconst CodeCell = () => {\n  const [code, setCode] = useState(\"\");\n  const [input, setInput] = useState(\"\");\n  const [err, setErr] = useState(\"\");\n\n  useEffect(() => {\n    const timer = setTimeout(async () => {\n      const output = await bundler(input);\n      setCode(output.code);\n      setErr(output.err);\n    }, 750);\n\n    return () => {\n      clearTimeout(timer);\n    }\n  }, [input])\n\n  return (\n    <Resizable direction=\"vertical\">\n      <div style={{ height: \"100%\", display: \"flex\" }}>\n        <Resizable direction=\"horizontal\">\n          <CodeEditor\n            initialValue=\"const a = 1;\"\n            onChange={(value) => setInput(value)}\n          />\n        </Resizable>\n        <Preview code={code} bundlingStatus={err}/>\n      </div>\n    </Resizable>\n  );\n};\n\nexport default CodeCell;\n","import \"bulmaswatch/superhero/bulmaswatch.min.css\";\nimport ReactDOM from \"react-dom/client\";\nimport CodeCell from \"./components/CodeCell\";\n\nconst el = document.getElementById(\"root\");\nconst root = ReactDOM.createRoot(el!);\n\nconst App = () => {\n\n  return (\n    <div>\n      <CodeCell />\n    </div>\n  );\n};\n\nroot.render(<App />);\n"],"sourceRoot":""}